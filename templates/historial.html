{% extends "base.html" %}
{% block title %}Mi Historial - App Mascotas{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 mb-10 pb-2">
        Mi Historial de Reportes
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        {% for reporte in reportes %}
        
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col
                    {% if reporte.estado == 'Perdido' %} border-t-8 border-red-500 {% else %} border-t-8 border-green-500 {% endif %}">
            
            {% if reporte.imagen_url %}
                <img src="{{ url_for('static', filename='uploads/' + reporte.imagen_url) }}" 
                     alt="Foto de {{ reporte.ia_especie or 'mascota' }}"
                     class="w-full h-48 object-cover">
            {% else %}
                <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-500">(Sin foto aprobada)</span>
                </div>
            {% endif %}
            
            <div class="p-6 flex-grow">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xl font-bold
                        {% if reporte.estado == 'Perdido' %} text-red-600 {% else %} text-green-600 {% endif %}">
                        {{ reporte.estado }}
                    </span>
                    <span class="text-sm font-medium text-gray-500">ID: {{ reporte.id }}</span>
                </div>

                <p class="text-gray-700 mb-4 h-24 overflow-y-auto">
                    {{ reporte.descripcion or 'Sin descripción.' }}
                </p>

                <div class="mb-4">
                    <span class="ia-tag">{{ reporte.ia_especie or 'N/A' }}</span>
                    <span class="ia-tag">{{ reporte.ia_raza or 'N/A' }}</span>
                    <span class="ia-tag">{{ reporte.ia_color_principal or 'N/A' }}</span>
                    <span class="ia-tag">{{ reporte.ia_collar or 'N/A' }}</span>
                    <br>
                    <span class="text-xs font-medium mt-2 
                        {% if reporte.ia_fuente == 'Foto+Texto' %} fuente-foto 
                        {% else %} fuente-texto {% endif %}">
                        (Fuente: {{ reporte.ia_fuente or 'N/A' }})
                    </span>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 border-t border-gray-100">
                <div class="text-sm text-gray-600">
                    <strong>Ubicación (aprox):</strong>
                    {% if reporte.latitud and reporte.longitud %}
                        <span class="font-mono text-xs">{{ "%.4f" | format(reporte.latitud) }}, {{ "%.4f" | format(reporte.longitud) }}</span>
                    {% else %}
                        <span class="text-gray-400">N/A</span>
                    {% endif %}
                </div>
                <div class="text-sm text-gray-600 mt-2">
                    <strong>Datos Foto:</strong> {{ reporte.fecha_foto or 'N/A' }} 
                    <span class="text-gray-400">{{ reporte.modelo_celular or '' }}</span>
                </div>
                <div class="text-sm text-gray-400 mt-2 truncate" title="{{ reporte.imagen_hash }}">
                    <strong>Hash:</strong> {{ reporte.imagen_hash or 'N/A' }}
                </div>
            </div>
        </div>
        {% endfor %}
        
        {% if not reportes %}
            <p class="text-gray-500 col-span-3 text-center text-lg">Aún no has creado ningún reporte.</p>
        {% endif %}
        
    </div> </div>
{% endblock %}

{% block scripts %}{% endblock %}